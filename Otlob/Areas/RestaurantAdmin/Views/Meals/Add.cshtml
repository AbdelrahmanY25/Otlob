@model MealRequest

<link rel="stylesheet" href="~/css/addMeal.css" asp-append-version="true" />

<div class="am-page">
    <div class="am-container">
        <div class="am-header">
            <a asp-action="Index" class="am-back-btn" title="Back to Meals">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="am-header-content">
                <h1>Add New Meal</h1>
                <p>Create a delicious new item for your menu</p>
            </div>
        </div>

        <div class="am-card">
            <div class="am-card-header">
                <h2>
                    <i class="fas fa-utensils"></i>
                    Meal Details
                </h2>
            </div>

            <div class="am-card-body">
                <form asp-action="Add" enctype="multipart/form-data">
                    <div asp-validation-summary="All" class="am-validation-errors"></div>

                    <div class="am-form-layout">
                        <div class="am-image-section">
                            <div class="am-image-upload">
                                <div class="am-image-preview" onclick="document.getElementById('fileInput').click()">
                                    <img id="mealLogo" src="~/images/Default.jpg" alt="Meal Image" />
                                    <div class="am-image-overlay">
                                        <i class="fas fa-camera"></i>
                                        <span>Change Image</span>
                                    </div>
                                </div>
                                <input class="am-file-input"
                                        id="fileInput"
                                        type="file"
                                        accept="image/*"
                                        name="image"
                                        onchange="previewImage(this)" />
                            </div>
                            <p class="am-image-hint">
                                <i class="fas fa-info-circle"></i>
                                Click to upload meal image (JPG, PNG)
                            </p>
                        </div>

                        <div class="am-fields-section">
                            <div class="am-form-group">
                                <label asp-for="Name" class="am-form-label">
                                    <i class="fas fa-tag"></i>
                                    Meal Name <span class="required">*</span>
                                </label>
                                <input asp-for="Name" class="am-form-input" placeholder="Enter meal name..." />
                            </div>

                            <div class="am-form-group">
                                <label asp-for="Description" class="am-form-label">
                                    <i class="fas fa-align-left"></i>
                                    Description
                                </label>
                                <textarea asp-for="Description" class="am-form-textarea" placeholder="Describe your meal..."></textarea>
                            </div>

                            <div class="am-form-row">
                                <div class="am-form-group">
                                    <label asp-for="Price" class="am-form-label">
                                        <i class="fas fa-dollar-sign"></i>
                                        Price <span class="required">*</span>
                                    </label>
                                    <input asp-for="Price" type="number" step="0.01" min="0" class="am-form-input" placeholder="0.00" />
                                </div>

                                <div class="am-form-group">
                                    <label asp-for="NumberOfServings" class="am-form-label">
                                        <i class="fas fa-users"></i>
                                        Servings
                                    </label>
                                    <div class="am-number-wrapper">
                                        <button type="button" class="am-number-btn" onclick="decrementServings()">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input asp-for="NumberOfServings" 
                                               type="number" 
                                               id="NumberOfServings" 
                                               class="am-number-input" 
                                               value="1" 
                                               min="1" 
                                               max="20" 
                                               readonly />
                                        <button type="button" class="am-number-btn" onclick="incrementServings()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="am-toggles-section">
                                <label class="am-toggle-card" id="availableCard">
                                    <div class="am-toggle-wrapper">
                                        <input asp-for="IsAvailable" type="checkbox" value="true" class="am-toggle-checkbox" onchange="toggleCard('availableCard', this.checked)" />
                                        <div class="am-toggle-switch"></div>
                                        <div class="am-toggle-content">
                                            <span class="am-toggle-label">Available</span>
                                            <span class="am-toggle-hint">Make meal available to customers</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="am-toggle-card" id="newMealCard">
                                    <div class="am-toggle-wrapper">
                                        <input asp-for="IsNewMeal" type="checkbox" value="true" class="am-toggle-checkbox" onchange="toggleCard('newMealCard', this.checked)" />
                                        <div class="am-toggle-switch"></div>
                                        <div class="am-toggle-content">
                                            <span class="am-toggle-label">New Meal</span>
                                            <span class="am-toggle-hint">Mark as newly added</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="am-toggle-card" id="trendingMealCard">
                                    <div class="am-toggle-wrapper">
                                        <input asp-for="IsTrendingMeal" type="checkbox" value="true" class="am-toggle-checkbox" onchange="toggleCard('trendingMealCard', this.checked)" />
                                        <div class="am-toggle-switch"></div>
                                        <div class="am-toggle-content">
                                            <span class="am-toggle-label">Trending</span>
                                            <span class="am-toggle-hint">Show in trending section</span>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <div class="am-category-section">
                                <div class="am-category-label">
                                    <i class="fas fa-layer-group"></i>
                                    Select Category
                                </div>
                                <select asp-for="SelectedCategoryKey" class="am-category-select">
                                    <option value="" disabled>Choose a category...</option>
                                @foreach (var category in Model.Categories!)
                                {
                                    <option value="@category.Key">@category.Name</option>
                                }
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Section -->
                    <div class="am-submit-section">
                        <button type="submit" class="am-submit-btn">
                            <i class="fas fa-plus-circle"></i>
                            Add Meal
                        </button>
                        <a asp-action="Index" class="am-cancel-btn">
                            <i class="fas fa-times"></i>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Image preview function
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('mealLogo').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Number of servings controls
        function incrementServings() {
            const input = document.getElementById('NumberOfServings');
            const currentValue = parseInt(input.value) || 1;
            if (currentValue < 20) {
                input.value = currentValue + 1;
            }
        }

        function decrementServings() {
            const input = document.getElementById('NumberOfServings');
            const currentValue = parseInt(input.value) || 1;
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        }

        // Toggle card active state
        function toggleCard(cardId, isChecked) {
            const card = document.getElementById(cardId);
            if (isChecked) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        }

        // Initialize toggle states on page load
        document.addEventListener('DOMContentLoaded', function () {
            const newMealCheckbox = document.querySelector('input[name="IsNewMeal"]');
            const trendingCheckbox = document.querySelector('input[name="IsTrendingMeal"]');
            
            if (newMealCheckbox && newMealCheckbox.checked) {
                toggleCard('newMealCard', true);
            }
            if (trendingCheckbox && trendingCheckbox.checked) {
                toggleCard('trendingMealCard', true);
            }
        });
    </script>
}
