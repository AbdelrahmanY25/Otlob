@model PromoCodeResponse

@{
    ViewData["Title"] = "Promo Code Details";
    var usageCount = ViewBag.UsageCount as int? ?? 0;
    var totalDiscountAmount = ViewBag.TotalDiscountAmount as decimal? ?? 0;
}

<link rel="stylesheet" href="~/css/promoCodes.css" asp-append-version="true" />

<div class="container py-4">
    <div class="row">
        <!-- Main Details Card -->
        <div class="col-lg-8">
            <div class="details-main-card">
                <div class="details-main-header">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <div class="d-flex align-items-center gap-3">
                            <div class="details-code-badge">
                                <i class="bi bi-ticket-perforated-fill"></i>
                            </div>
                            <div>
                                <h4 class="details-code-text mb-1">@Model.Code</h4>
                                <span class="details-discount-text">@Model.DiscountDisplay</span>
                            </div>
                        </div>
                        <span class="details-status-badge @Model.Status.ToLower()">@Model.Status</span>
                    </div>
                </div>
                <div class="details-main-body">
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="details-description">
                            <i class="bi bi-quote"></i>
                            <p>@Model.Description</p>
                        </div>
                    }

                    <div class="details-info-grid">
                        <div class="details-info-item">
                            <div class="details-info-icon discount">
                                <i class="bi bi-percent"></i>
                            </div>
                            <div>
                                <span class="details-info-label">Discount</span>
                                <span class="details-info-value">@Model.DiscountDisplay</span>
                            </div>
                        </div>
                        <div class="details-info-item">
                            <div class="details-info-icon type">
                                <i class="bi bi-tag"></i>
                            </div>
                            <div>
                                <span class="details-info-label">Type</span>
                                <span class="details-info-value">@Model.DiscountTypeDisplay</span>
                            </div>
                        </div>
                        @if (Model.MaxDiscountAmount.HasValue)
                        {
                            <div class="details-info-item">
                                <div class="details-info-icon max">
                                    <i class="bi bi-arrow-up-circle"></i>
                                </div>
                                <div>
                                    <span class="details-info-label">Max Discount</span>
                                    <span class="details-info-value">@Model.MaxDiscountAmount.Value.ToString("N2") L.E</span>
                                </div>
                            </div>
                        }
                        <div class="details-info-item">
                            <div class="details-info-icon min">
                                <i class="bi bi-cart-check"></i>
                            </div>
                            <div>
                                <span class="details-info-label">Min Order</span>
                                <span class="details-info-value">@(Model.MinOrderAmount.HasValue ? Model.MinOrderAmount.Value.ToString("N2") + " L.E" : "No minimum")</span>
                            </div>
                        </div>
                    </div>

                    <hr class="details-divider" />

                    <div class="details-dates-row">
                        <div class="details-date-item">
                            <i class="bi bi-calendar-event text-primary"></i>
                            <div>
                                <span class="details-date-label">Valid From</span>
                                <span class="details-date-value">@Model.ValidFrom.ToString("dd MMMM yyyy, hh:mm tt")</span>
                            </div>
                        </div>
                        <div class="details-date-item">
                            <i class="bi bi-calendar-x text-danger"></i>
                            <div>
                                <span class="details-date-label">Valid To</span>
                                <span class="details-date-value">@Model.ValidTo.ToString("dd MMMM yyyy, hh:mm tt")</span>
                            </div>
                        </div>
                    </div>

                    <hr class="details-divider" />

                    <div class="details-extra-row">
                        <div class="details-extra-item">
                            <span class="details-extra-label">Max Usage Per User</span>
                            <span class="details-extra-value">@Model.MaxUsagePerUser time(s)</span>
                        </div>
                        <div class="details-extra-item">
                            <span class="details-extra-label">First Order Only</span>
                            <span class="details-extra-value">
                                @if (Model.IsFirstOrderOnly)
                                {
                                    <span class="text-purple"><i class="bi bi-check-circle-fill me-1"></i>Yes</span>
                                }
                                else
                                {
                                    <span class="text-muted"><i class="bi bi-x-circle me-1"></i>No</span>
                                }
                            </span>
                        </div>
                        <div class="details-extra-item">
                            <span class="details-extra-label">Created At</span>
                            <span class="details-extra-value">@Model.CreatedAt.ToString("dd MMMM yyyy, hh:mm tt")</span>
                        </div>
                    </div>
                </div>
                <div class="details-main-footer">
                    <a asp-action="Index" class="btn-details-back">
                        <i class="bi bi-arrow-left me-1"></i> Back to List
                    </a>
                    <div class="details-actions-group">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn-details-edit">
                            <i class="bi bi-pencil me-1"></i> Edit
                        </a>
                        @if (Model.IsActive)
                        {
                            <form asp-action="Deactivate" asp-route-id="@Model.Id" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn-details-deactivate" onclick="return confirm('Are you sure you want to deactivate this code?')">
                                    <i class="bi bi-pause-circle me-1"></i> Deactivate
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-action="Activate" asp-route-id="@Model.Id" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn-details-activate">
                                    <i class="bi bi-play-circle me-1"></i> Activate
                                </button>
                            </form>
                        }
                        <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn-details-delete" onclick="return confirm('Are you sure you want to permanently delete this promo code?')">
                                <i class="bi bi-trash me-1"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Sidebar -->
        <div class="col-lg-4">
            <div class="details-stats-card">
                <div class="details-stats-header">
                    <i class="bi bi-bar-chart-fill"></i>
                    <h5>Usage Statistics</h5>
                </div>
                <div class="details-stats-body">
                    <div class="stats-usage-section">
                        <span class="stats-label">Total Usage</span>
                        <div class="stats-usage-display">
                            <span class="stats-usage-count">@usageCount</span>
                            <span class="stats-usage-max">/ @(Model.MaxTotalUsage?.ToString() ?? "âˆž")</span>
                        </div>
                        @if (Model.MaxTotalUsage.HasValue)
                        {
                            var percentage = Model.MaxTotalUsage.Value > 0 ? (usageCount * 100.0 / Model.MaxTotalUsage.Value) : 0;
                            <div class="stats-progress">
                                <div class="stats-progress-fill" style="width: @percentage%"></div>
                            </div>
                        }
                    </div>

                    <div class="stats-discount-section">
                        <span class="stats-label">Total Discount Given</span>
                        <span class="stats-discount-value">@totalDiscountAmount.ToString("N2") L.E</span>
                    </div>
                </div>
            </div>

            <div class="details-quick-card">
                <div class="details-quick-header">
                    <i class="bi bi-info-circle-fill"></i>
                    <h5>Quick Info</h5>
                </div>
                <div class="details-quick-body">
                    <div class="quick-info-item">
                        <i class="bi bi-@(Model.IsActive ? "check-circle-fill text-success" : "pause-circle-fill text-secondary")"></i>
                        <span>@(Model.IsActive ? "Currently active" : "Currently inactive")</span>
                    </div>
                    <div class="quick-info-item">
                        <i class="bi bi-calendar-fill text-primary"></i>
                        @if (Model.IsExpired)
                        {
                            <span class="text-danger">Expired</span>
                        }
                        else if (Model.IsNotStarted)
                        {
                            <span class="text-info">Starts in @((Model.ValidFrom - DateTime.Now).Days) days</span>
                        }
                        else
                        {
                            <span>@((Model.ValidTo - DateTime.Now).Days) days remaining</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
