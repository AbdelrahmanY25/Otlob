@model IQueryable<MealResponse>

<link rel="stylesheet" href="~/css/meals.css" asp-append-version="true" />

<div class="ml-page">
    <div class="ml-container">
        <div class="ml-header">
            <div class="ml-header-info">
                <h1>
                    <i class="fas fa-utensils"></i>
                    Menu Management
                </h1>
                <p>Overview of all your restaurant meals</p>
            </div>
            <a asp-action="Add" class="ml-add-btn">
                <i class="fas fa-plus"></i>
                New Meal
            </a>
        </div>

        @if (!Model.Any())
        {
            <div class="ml-empty">
                <div class="ml-empty-icon">
                    <i class="fas fa-plate-wheat"></i>
                </div>
                <h3>No meals found</h3>
                <p>Your menu is currently empty. Add your first delicious meal!</p>
                <a asp-action="Add" class="ml-add-btn">
                    Create Meal
                </a>
            </div>
        }
        else
        {
            <div class="ml-table-container">
                <table class="ml-table">
                    <thead>
                        <tr>
                            <th width="45%">Meal</th>
                            <th width="20%">Price</th>
                            <th width="35%" style="text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    <div class="ml-meal-info">
                                        <img src="/images/@(item.Image ?? "Default.jpg")" alt="@item.Name" class="ml-meal-img" />
                                        <div>
                                            <div class="ml-meal-name">@item.Name</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="ml-price-badge">@item.Price.ToString("0.00") L.E</span>
                                </td>
                                <td>
                                    <div class="ml-actions">
                                        <a asp-action="Update" asp-route-key="@item.Key" class="ml-action-btn view" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a asp-controller="MealPrices" asp-action="PricesHistory" asp-route-id="@item.Key" class="ml-action-btn history" title="Price History">
                                            <i class="fas fa-history"></i>
                                        </a>
                                        <button type="button"
                                                class="ml-action-btn delete"
                                                title="Delete Meal"
                                                data-bs-toggle="modal"
                                                data-bs-target="#deleteModal"
                                                data-mealid="@item.Key">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="ml-mobile-grid">
                @foreach (var item in Model)
                {
                    <div class="ml-mobile-card">
                        <img src="/images/@(item.Image ?? "Default.jpg")" alt="@item.Name" class="ml-mobile-img" />
                        <div class="ml-mobile-content">
                            <div class="ml-mobile-header">
                                <div>
                                    <div class="ml-mobile-name">@item.Name</div>
                                    <span class="ml-price-badge">@item.Price</span>
                                </div>
                            </div>
                            <div class="ml-mobile-actions">
                                <a asp-action="Update" asp-route-id="@item.Key" class="ml-mobile-action" style="color: #0284c7;">
                                    <i class="fas fa-eye"></i> Details
                                </a>
                                <a asp-controller="MealPrices" asp-action="PricesHistory" asp-route-id="@item.Key" class="ml-mobile-action" style="color: #059669;">
                                    <i class="fas fa-history"></i> History
                                </a>
                                <a href="#"
                                   class="ml-mobile-action"
                                   style="color: #dc2626;"
                                   data-bs-toggle="modal"
                                   data-bs-target="#deleteModal"
                                   data-mealid="@item.Key">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 16px;">
            <div class="modal-body p-4 text-center">
                <div style="width: 60px; height: 60px; background: #fef2f2; color: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.5rem;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h4 style="font-weight: 700; margin-bottom: 0.5rem; color: #1e293b;">Delete Meal?</h4>
                <p style="color: #64748b; margin-bottom: 2rem;">Are you sure you want to remove this meal from your menu? This action cannot be undone.</p>

                <form asp-action="Delete" method="post" class="d-flex gap-2 justify-content-center">
                    <input type="hidden" name="id" id="mealIdInput" />
                    <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal" style="border-radius: 10px; font-weight: 600;">Cancel</button>
                    <button type="submit" class="btn btn-danger px-4 py-2" style="border-radius: 10px; font-weight: 600; background: #dc2626; border: none;">Delete Meal</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_NotificationPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var deleteModal = document.getElementById('deleteModal');
            if (deleteModal) {
                deleteModal.addEventListener('show.bs.modal', function (event) {
                    var button = event.relatedTarget;
                    var mealId = button.getAttribute('data-mealid');
                    var input = document.getElementById('mealIdInput');
                    if(input) input.value = mealId;
                });
            }
        });
    </script>
}
