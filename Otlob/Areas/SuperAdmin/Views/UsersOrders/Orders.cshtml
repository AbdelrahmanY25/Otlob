@model List<OrderHistoryResponse>

@{
    ViewData["Title"] = "User Orders";
    var userId = ViewBag.UserId as string;
}

<link href="~/css/adminUserOrders.css" rel="stylesheet" asp-append-version="true" />

<div class="admin-orders-page">
    <div class="admin-orders-container">
        <a asp-area="SuperAdmin" asp-controller="UserProfile" asp-action="UserProfile" asp-route-id="@userId" class="admin-back-link">
            <i class="fas fa-arrow-left"></i> Back to User Profile
        </a>

        <div class="admin-page-header">
            <h1 class="admin-page-title">
                <i class="fas fa-shopping-bag"></i> User Orders
            </h1>
        </div>

        @if (Model.Count == 0)
        {
            <div class="admin-empty-orders">
                <i class="fas fa-inbox"></i>
                <h3>No orders found</h3>
                <p>This user hasn't placed any orders yet.</p>
            </div>
        }
        else
        {
            @foreach (var order in Model)
            {
                <div class="admin-order-card" data-order-id="@order.Id" data-status="@order.Status">
                    <div class="admin-order-card-content">
                        <a asp-action="OrderDetails" asp-route-id="@order.Id" asp-route-userId="@userId" class="admin-order-card-link">
                            <div class="admin-order-header">
                                @if (!string.IsNullOrEmpty(order.RestaurantImage))
                                {
                                    <img src="~/images/@order.RestaurantImage" alt="@order.RestaurantName" class="admin-restaurant-logo" />
                                }
                                else
                                {
                                    <div class="admin-restaurant-logo-placeholder">
                                        <i class="fas fa-store"></i>
                                    </div>
                                }
                                <div class="admin-order-info">
                                    <h3 class="admin-restaurant-name">@order.RestaurantName</h3>
                                    <div class="admin-order-meta">
                                        <span><i class="far fa-calendar"></i> @order.OrderDate.ToString("MMM dd, yyyy")</span>
                                        <span><i class="far fa-clock"></i> @order.OrderDate.ToString("hh:mm tt")</span>
                                        <span><i class="fas fa-box"></i> @order.ItemsCount items</span>
                                    </div>
                                </div>
                                <span class="admin-status-badge admin-status-@order.Status.ToString().ToLower()">
                                    @switch (order.Status)
                                    {
                                        case OrderStatus.Pending:
                                            <i class="fas fa-hourglass-half"></i>
                                            break;
                                        case OrderStatus.Preparing:
                                            <i class="fas fa-fire"></i>
                                            break;
                                        case OrderStatus.Shipped:
                                            <i class="fas fa-truck"></i>
                                            break;
                                        case OrderStatus.Delivered:
                                            <i class="fas fa-check-circle"></i>
                                            break;
                                        case OrderStatus.Cancelled:
                                            <i class="fas fa-times-circle"></i>
                                            break;
                                    }
                                    @order.Status
                                </span>
                            </div>
                            <div class="admin-order-footer">
                                <div>
                                    <span class="admin-order-total">@order.TotalPrice.ToString("N2") L.E</span>
                                    <span class="admin-payment-method">
                                        @if (order.PaymentMethod == PaymentMethod.Cash)
                                        {
                                            <i class="fas fa-money-bill-wave"></i>
                                            <span>Cash</span>
                                        }
                                        else
                                        {
                                            <i class="fas fa-credit-card"></i>
                                            <span>Card</span>
                                        }
                                    </span>
                                </div>
                                <span class="admin-view-details">
                                    View Details <i class="fas fa-chevron-right"></i>
                                </span>
                            </div>
                        </a>
                        @if (order.Status == OrderStatus.Delivered)
                        {
                            <div class="admin-order-actions">
                                @if (order.IsRated)
                                {
                                    <a asp-action="ViewRating" asp-route-orderId="@order.Id" asp-route-userId="@userId" class="admin-view-rating-btn">
                                        <i class="fas fa-star"></i> View Rating
                                    </a>
                                }
                                else
                                {
                                    <span class="admin-not-rated-badge">
                                        <i class="far fa-star"></i> Not rated yet
                                    </span>
                                }
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/adminUserOrders.js" asp-append-version="true"></script>
}
