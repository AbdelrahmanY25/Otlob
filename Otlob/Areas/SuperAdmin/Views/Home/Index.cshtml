@using Otlob.Core.Contracts.ViewModel
@model OrdersAnalysisVM

@{      
    ViewData["Title"] = "Super Admin Home Page";

    var ordersAnalytics = Json.Serialize(Model.ordersOverLastTwelveMonths);
}

<link rel="stylesheet" href="~/css/OrdersAnalysis.css" asp-append-version="true" />

<div class="header">
    <h3>📊 Orders Analytics Dashboard</h3>
</div>

<div class="stats-grid">
    <div class="stat-cards">
        <div class="stat-value" id="totalOrders">0</div>
        <div class="stat-label">Total Orders</div>
    </div>
    <div class="stat-cards">
        <div class="stat-value" id="totalRevenue">EGP0</div>
        <div class="stat-label">Total Revenue</div>
    </div>
    <div class="stat-cards">
        <div class="stat-value" id="avgOrderValue">EGP0</div>
        <div class="stat-label">Average Order Value</div>
    </div>
    <div class="stat-cards">
        <div class="stat-value" id="bestMonth">-</div>
        <div class="stat-label">Best Month</div>
    </div>
</div>

<div class="charts-container">
    <div class="chart-wrapper">
        <div class="chart-title">Monthly Orders</div>
        <canvas id="ordersChart"></canvas>
    </div>

    <div class="chart-wrapper">
        <div class="chart-title">Monthly Revenue</div>
        <canvas id="revenueChart"></canvas>
    </div>
</div>

<div class="table-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #2c3e50; margin: 0;">📋 Detailed Monthly Breakdown</h2>
        <div class="export-icons">
            <button class="export-btn" id="exportExcel" title="Export to Excel">
                <img src="~/images/icons/sheet.png" alt="Export to Excel" />
            </button>           
        </div>
    </div>
    <table class="data-table">
        <thead>
            <tr>
                <th>Month</th>
                <th>Total Orders</th>
                <th>Total Revenue</th>
                <th>Average Order Value</th>
                <th>Growth Rate</th>
            </tr>
        </thead>
        <tbody id="dataTableBody">
        </tbody>
    </table>
</div>

<div class="ordersData">
    <div class="card p-4 shadow-sm">
        <h6 class="text-center">Order Status Overview</h6>
        <div class="chart-container">
            <canvas id="orderStatusChart"></canvas>
        </div>
        <div class="chart-controls">
            <button class="control-btn active" onclick="toggleChartType('doughnut')">Doughnut</button>
            <button class="control-btn" onclick="toggleChartType('pie')">Pie</button>
            <button class="control-btn" onclick="toggleChartType('bar')">Bar</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const orderStatusData = {
        @foreach (var item in Model.ordersStatusPercentages!)
        {
            <text>"@item.Key": @item.Value,</text>
        }
    };

    const sampleData = @ordersAnalytics;        
</script>


@section Scripts {
    <script>
      document.getElementById('exportExcel')
        .addEventListener('click', function() {
            window.location.href = '@Url.Action("ExportOrdersOverLastTwelveMonthExcel", "Reports")';
      });     
    </script>

    <script src="~/js/OrdersAnalysis.js"></script>
    <partial name="_NotificationPartial"></partial>
}
